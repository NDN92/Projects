package de.NDN.app.writeInvoice.document.print;

import java.awt.Canvas;
import java.awt.Color;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.Image;
import java.awt.MediaTracker;
import java.awt.Shape;
import java.awt.print.PageFormat;
import java.awt.print.Printable;
import java.awt.print.PrinterException;
import java.util.ArrayList;


public class DocumentInvoicePrintable implements Printable {
	
	private ArrayList<Object[]> pageShapes;
	private ArrayList<Object[]> pageImages;
	
	@Override
	public int print(Graphics graphics, PageFormat pageFormat, int pageIndex) throws PrinterException {		
		if (pageIndex > 0) {
	         return NO_SUCH_PAGE;
	    }
		
		Graphics2D graphics2D = (Graphics2D) graphics;
		graphics2D.translate(pageFormat.getImageableX(), pageFormat.getImageableY());
		
		for(Object[] ShapeAndInfos : pageShapes) {
			
			//"Unpack" and convert ShapeAndInfos
			Shape shape = (Shape) ShapeAndInfos[0];
			Color color = (Color) ShapeAndInfos[1];
			
			if(color != null) {
				graphics2D.setPaint(color);
				graphics2D.fill(shape);
			}
			
			graphics2D.draw(shape);
		}
		for(Object[] imgAndInfos : pageImages) {
			
			//"Unpack" and convert imgAndInfos
			Image image 			= 	(Image) imgAndInfos[0];
			int   desiredImgWidth 	= 	(int) 	imgAndInfos[1];
			int   desiredImgHeight 	= 	(int) 	imgAndInfos[2];
			int   imgX 				=	(int)	imgAndInfos[3];
			int   imgY 				=	(int)	imgAndInfos[4];
			
			
			MediaTracker tracker = new MediaTracker( new Canvas() );
			tracker.addImage(image, 0);			
			try {
				tracker.waitForID(0);
			} catch (InterruptedException e) {
				e.printStackTrace();
			}	
			
			int fullImgWidth = image.getWidth(null);
			int fullImgHeight = image.getHeight(null);
			
			if( fullImgWidth != -1 && fullImgWidth != 0 && fullImgHeight != -1 && fullImgHeight != 0 ) {
				
				double ratio = ((double) fullImgWidth) / ((double) fullImgHeight);				
				
				if( desiredImgWidth == -1 && desiredImgHeight == -1) {
					System.out.println("Fehler!");
					continue;
				}
				else if( desiredImgWidth == -1 ) 	desiredImgWidth = (int) Math.round( ((double) desiredImgHeight) * ratio);
				else if( desiredImgHeight == -1 )	desiredImgHeight = (int) Math.round( ((double) desiredImgWidth) / ratio);				
				
				graphics2D.drawImage(image, imgX, imgY, desiredImgWidth, desiredImgHeight, null);
			}			
		}
		
		
		
		//Image img = new ImageIcon("companyLogo.png").getImage();
//		Image img = Toolkit.getDefaultToolkit().getImage("companyLogo.png");
//		int imgWidth = img.getWidth(null);
//		int imgHeight = img.getHeight(null);
//		graphics2D.drawImage(img, 0, 0, img.getWidth(null), img.getHeight(null), null);
		
		
		
		return Printable.PAGE_EXISTS;
	}

	public ArrayList<Object[]> getPageShapes() {
		return pageShapes;
	}

	public void setPageShapes(ArrayList<Object[]> pageShapes) {
		this.pageShapes = pageShapes;
	}

	public ArrayList<Object[]> getPageImages() {
		return pageImages;
	}

	public void setPageImages(ArrayList<Object[]> pageImages) {
		this.pageImages = pageImages;
	}

}
